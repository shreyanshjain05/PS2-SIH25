# ğŸŒ¬ï¸ PS2-SIH25: Air Quality Forecasting System
## Complete Project Workflow & Architecture Documentation

---

## ğŸ“‹ Table of Contents
1. [Project Overview](#project-overview)
2. [System Architecture](#system-architecture)
3. [Data Pipeline Flowchart](#data-pipeline-flowchart)
4. [Component Details](#component-details)
5. [ML Model Pipeline](#ml-model-pipeline)
6. [API Architecture](#api-architecture)
7. [Deployment Architecture](#deployment-architecture)
8. [Feature Engineering Details](#feature-engineering-details)

---

## ğŸ¯ Project Overview

This project is an **Air Quality Forecasting System** that predicts **Oâ‚ƒ (Ozone)** and **NOâ‚‚ (Nitrogen Dioxide)** concentrations using machine learning models trained on:
- Historical air quality data
- Satellite observations
- ERA5 reanalysis weather data
- Spatial features from monitoring stations

### Key Capabilities:
- ğŸ”® **Hourly forecasting** of Oâ‚ƒ and NOâ‚‚ concentrations
- ğŸ“Š **Multi-site predictions** for 7 monitoring stations
- ğŸŒ¡ï¸ **Weather-integrated forecasting** using ERA5 data
- ğŸ›°ï¸ **Satellite data integration** (TROPOMI NOâ‚‚, HCHO)
- ğŸ“ˆ **Real-time recursive forecasting** for future predictions

---

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SYSTEM ARCHITECTURE                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   USERS      â”‚
                              â”‚  (Citizens/  â”‚
                              â”‚  Govt/Biz)   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      NEXT.JS WEB APPLICATION   â”‚
                    â”‚         (Port 3000)            â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚  â”‚  Dashboard & Visualizationsâ”‚
                    â”‚  â”‚  - Citizen View          â”‚   â”‚
                    â”‚  â”‚  - Government View       â”‚   â”‚
                    â”‚  â”‚  - Business API Portal   â”‚   â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                            â”‚
                    â–¼                            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ELYSIA API LAYER    â”‚      â”‚    ML SERVICE (FastAPI)â”‚
    â”‚   /api/v1/*           â”‚â—„â”€â”€â”€â”€â–ºâ”‚      (Port 8000)       â”‚
    â”‚                       â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  - /sites             â”‚      â”‚  â”‚  XGBoost Models â”‚   â”‚
    â”‚  - /forecast          â”‚      â”‚  â”‚  - O3 Model     â”‚   â”‚
    â”‚  - /timeseries        â”‚      â”‚  â”‚  - NO2 Model    â”‚   â”‚
    â”‚  - /sample-data       â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                              â”‚
                â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   PostgreSQL DB       â”‚      â”‚   Model Artifacts     â”‚
    â”‚   - Auth DB           â”‚      â”‚   - production_O3.jsonâ”‚
    â”‚   - Business DB       â”‚      â”‚   - production_NO2.jsonâ”‚
    â”‚   - Credits System    â”‚      â”‚                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      Redis Cache      â”‚
    â”‚   - Session Store     â”‚
    â”‚   - API Rate Limiting â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Pipeline Flowchart

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA PIPELINE FLOWCHART                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                      1. RAW DATA SOURCES                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                    â”‚                    â”‚
                â–¼                    â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Site Train Data  â”‚ â”‚   ERA5 Weather    â”‚ â”‚ Satellite Data    â”‚
    â”‚  (7 CSV files)    â”‚ â”‚   (NetCDF files)  â”‚ â”‚ (NO2, HCHO)       â”‚
    â”‚                   â”‚ â”‚                   â”‚ â”‚                   â”‚
    â”‚  - O3_target      â”‚ â”‚  - Temperature    â”‚ â”‚  - NO2_satellite  â”‚
    â”‚  - NO2_target     â”‚ â”‚  - Humidity       â”‚ â”‚  - HCHO_satellite â”‚
    â”‚  - O3_forecast    â”‚ â”‚  - Wind (u,v,w)   â”‚ â”‚  - ratio_satelliteâ”‚
    â”‚  - NO2_forecast   â”‚ â”‚  - BLH            â”‚ â”‚                   â”‚
    â”‚  - T,q,u,v,w,blh  â”‚ â”‚  - Cloud Cover    â”‚ â”‚                   â”‚
    â”‚                   â”‚ â”‚  - Solar Rad      â”‚ â”‚                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                     â”‚                     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    2. DATA PROCESSING                                â”‚
    â”‚                 (train-dataset-engineered.py)                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼              â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Lag Featuresâ”‚  â”‚Rolling Mean â”‚ â”‚Spatial IDW  â”‚ â”‚ Time Encode â”‚
    â”‚             â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚
    â”‚ - lag_1h    â”‚  â”‚ - roll24    â”‚ â”‚ - O3_idw    â”‚ â”‚ - hour_sin  â”‚
    â”‚ - lag_3h    â”‚  â”‚   _mean     â”‚ â”‚ - NO2_idw   â”‚ â”‚ - hour_cos  â”‚
    â”‚ - lag_6h    â”‚  â”‚             â”‚ â”‚ - city_mean â”‚ â”‚ - month_sin â”‚
    â”‚ - lag_12h   â”‚  â”‚             â”‚ â”‚ - city_std  â”‚ â”‚ - month_cos â”‚
    â”‚ - lag_24h   â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚                â”‚               â”‚               â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 3. ENGINEERED DATASET                                â”‚
    â”‚              (train_dataset_engineered.csv)                          â”‚
    â”‚                                                                      â”‚
    â”‚   171,511 rows Ã— 45+ features                                        â”‚
    â”‚   Sites: 1-7 | Period: 2019-07 to 2024-06                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    4. MODEL TRAINING                                 â”‚
    â”‚                  (Validation Pipeline)                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   TRAINING SET            â”‚   â”‚     TEST SET              â”‚
    â”‚   (2019-2023)             â”‚   â”‚     (2024)                â”‚
    â”‚   155,232 rows            â”‚   â”‚     16,279 rows           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                               â”‚
                â–¼                               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   XGBoost Training        â”‚   â”‚   Model Validation        â”‚
    â”‚                           â”‚   â”‚                           â”‚
    â”‚   O3 Model:               â”‚   â”‚   O3: RÂ²=0.9456           â”‚
    â”‚   - n_estimators: 500     â”‚   â”‚   NO2: RÂ²=0.8663          â”‚
    â”‚   - max_depth: 9          â”‚   â”‚                           â”‚
    â”‚   - learning_rate: 0.03   â”‚   â”‚                           â”‚
    â”‚                           â”‚   â”‚                           â”‚
    â”‚   NO2 Model:              â”‚   â”‚                           â”‚
    â”‚   - Same hyperparameters  â”‚   â”‚                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    5. PRODUCTION MODELS                              â”‚
    â”‚                                                                      â”‚
    â”‚   artifacts/FINAL_PRODUCTION_MODELS/                                 â”‚
    â”‚   â”œâ”€â”€ production_O3_era5_spatial.json                               â”‚
    â”‚   â””â”€â”€ production_NO2_era5_spatial.json                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Component Details

### 1. Data Collection Layer

| Component | Source | Description |
|-----------|--------|-------------|
| **Site Data** | CPCB/DPCC | Hourly Oâ‚ƒ, NOâ‚‚ readings from 7 monitoring stations |
| **ERA5 Weather** | Copernicus CDS | Reanalysis weather data (temperature, humidity, wind, BLH, etc.) |
| **Satellite Data** | Sentinel-5P TROPOMI | Column densities of NOâ‚‚ and HCHO |
| **Coordinates** | lat_lon_sites.txt | Geographic coordinates of 7 monitoring sites |

### 2. Feature Engineering

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FEATURE CATEGORIES (40+ FEATURES)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FORECAST FEATURES   â”‚  â”‚ SATELLITE FEATURES  â”‚  â”‚ LAG FEATURES        â”‚
â”‚                     â”‚  â”‚                     â”‚  â”‚                     â”‚
â”‚ â€¢ O3_forecast       â”‚  â”‚ â€¢ NO2_satellite     â”‚  â”‚ â€¢ O3_lag_1h/3h/6h   â”‚
â”‚ â€¢ NO2_forecast      â”‚  â”‚ â€¢ HCHO_satellite    â”‚  â”‚ â€¢ O3_lag_12h/24h    â”‚
â”‚ â€¢ T_forecast        â”‚  â”‚ â€¢ ratio_satellite   â”‚  â”‚ â€¢ NO2_lag_1h/3h/6h  â”‚
â”‚ â€¢ q_forecast        â”‚  â”‚ â€¢ NO2_to_HCHO_ratio â”‚  â”‚ â€¢ NO2_lag_12h/24h   â”‚
â”‚ â€¢ u/v/w_forecast    â”‚  â”‚                     â”‚  â”‚                     â”‚
â”‚ â€¢ blh_forecast      â”‚  â”‚                     â”‚  â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ROLLING FEATURES    â”‚  â”‚ SPATIAL FEATURES    â”‚  â”‚ TIME FEATURES       â”‚
â”‚                     â”‚  â”‚                     â”‚  â”‚                     â”‚
â”‚ â€¢ O3_roll24_mean    â”‚  â”‚ â€¢ lat, lon, site    â”‚  â”‚ â€¢ hour_sin/cos      â”‚
â”‚ â€¢ NO2_roll24_mean   â”‚  â”‚ â€¢ O3_city_mean_lag1 â”‚  â”‚ â€¢ month_sin/cos     â”‚
â”‚                     â”‚  â”‚ â€¢ O3_city_std_lag1  â”‚  â”‚ â€¢ wind_speed        â”‚
â”‚                     â”‚  â”‚ â€¢ NO2_city_mean_lag1â”‚  â”‚ â€¢ O3_forecast_x_windâ”‚
â”‚                     â”‚  â”‚ â€¢ O3_idw_lag1       â”‚  â”‚ â€¢ NO2_forecast_x_windâ”‚
â”‚                     â”‚  â”‚ â€¢ NO2_idw_lag1      â”‚  â”‚                     â”‚
â”‚                     â”‚  â”‚ â€¢ O3_diff_mean_lag1 â”‚  â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERA5 WEATHER        â”‚
â”‚                     â”‚
â”‚ â€¢ era5_blh          â”‚
â”‚ â€¢ era5_tcc          â”‚
â”‚ â€¢ era5_t2m          â”‚
â”‚ â€¢ era5_d2m          â”‚
â”‚ â€¢ era5_ssrd         â”‚
â”‚ â€¢ era5_tp           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¤– ML Model Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ML PREDICTION PIPELINE                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  INPUT DATA  â”‚
                              â”‚  (JSON/CSV)  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     1. DATA VALIDATION         â”‚
                    â”‚     - Check required columns   â”‚
                    â”‚     - Parse datetime           â”‚
                    â”‚     - Validate site_id         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     2. FEATURE PREPARATION     â”‚
                    â”‚     prepare_features()         â”‚
                    â”‚                                â”‚
                    â”‚     - Add missing columns      â”‚
                    â”‚     - Compute lag features     â”‚
                    â”‚     - Add ERA5 weather data    â”‚
                    â”‚     - Compute spatial features â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                       â”‚
                         â–¼                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  HISTORICAL DATA   â”‚   â”‚   FUTURE DATA      â”‚
            â”‚  (has O3/NO2       â”‚   â”‚   (NaN targets)    â”‚
            â”‚   target values)   â”‚   â”‚                    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                        â”‚
                      â–¼                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  BATCH PREDICTION  â”‚   â”‚ RECURSIVE FORECAST â”‚
            â”‚                    â”‚   â”‚                    â”‚
            â”‚  Single pass       â”‚   â”‚  For each step:    â”‚
            â”‚  through XGBoost   â”‚   â”‚  1. Predict        â”‚
            â”‚                    â”‚   â”‚  2. Fill target    â”‚
            â”‚                    â”‚   â”‚  3. Update lags    â”‚
            â”‚                    â”‚   â”‚  4. Next step      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                        â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     3. POST-PROCESSING         â”‚
                    â”‚                                â”‚
                    â”‚     - Optional resampling      â”‚
                    â”‚     - Smoothing (12H rolling)  â”‚
                    â”‚     - Error metrics            â”‚
                    â”‚     - Format response          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     OUTPUT RESPONSE            â”‚
                    â”‚                                â”‚
                    â”‚     {                          â”‚
                    â”‚       "dates": [...],          â”‚
                    â”‚       "historical": {...},     â”‚
                    â”‚       "forecast": {            â”‚
                    â”‚         "O3_target": [...],    â”‚
                    â”‚         "NO2_target": [...]    â”‚
                    â”‚       },                       â”‚
                    â”‚       "metadata": {...}        â”‚
                    â”‚     }                          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Model Performance

| Model | Train RÂ² | Test RÂ² | Train RMSE | Test RMSE |
|-------|----------|---------|------------|-----------|
| **Oâ‚ƒ** | 0.9716 | 0.9456 | 5.501 | 9.929 |
| **NOâ‚‚** | 0.9692 | 0.8663 | 5.088 | 11.302 |

### Top Feature Importances

**Oâ‚ƒ Model:**
1. `O3_lag_1h` (58.6%)
2. `era5_ssrd` (7.3%)
3. `O3_lag_24h` (7.1%)
4. `O3_city_mean_lag1` (6.2%)

**NOâ‚‚ Model:**
1. `NO2_lag_1h` (68.9%)
2. `NO2_roll24_mean` (4.9%)
3. `NO2_city_mean_lag1` (4.1%)
4. `NO2_lag_24h` (3.5%)

---

## ğŸŒ API Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API ENDPOINTS                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PUBLIC API (v1) - Requires API Key                    â”‚
â”‚                    Credit-based access                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    GET  /api/v1/                    â”‚ API Documentation (free)
    GET  /api/v1/sites               â”‚ List monitoring sites (10 credits)
    GET  /api/v1/sites/:id/data      â”‚ Get sample data (50 credits)
    POST /api/v1/forecast            â”‚ Generate forecast (100 credits)
    POST /api/v1/forecast/timeseries â”‚ Detailed timeseries (150 credits)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INTERNAL API (AQI) - Auth Required                    â”‚
â”‚                    No credits charged                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    GET  /api/aqi/sites              â”‚ Get all sites
    POST /api/aqi/sample-data        â”‚ Get sample input data
    POST /api/aqi/predict            â”‚ Run prediction
    POST /api/aqi/forecast/timeseriesâ”‚ Full timeseries forecast

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ML SERVICE ENDPOINTS (Direct)                         â”‚
â”‚                    Port 8000                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    GET  /sites/                     â”‚ List available sites
    GET  /health/                    â”‚ Health check
    
    POST /forecast/json/             â”‚ Forecast from JSON
    POST /forecast/file/             â”‚ Forecast from CSV upload
    
    POST /plots/performance/json/    â”‚ 12H smoothed view
    POST /plots/diagnostic/json/     â”‚ 6H resampled view
    POST /plots/timeseries/json/     â”‚ Raw timeseries
    POST /plots/extreme/json/        â”‚ Extreme pollution detection
    
    POST /predict/                   â”‚ Simple prediction
    WS   /ws/predict/                â”‚ WebSocket real-time
```

---

## ğŸ³ Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DOCKER COMPOSE SERVICES                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   sih-db        â”‚  â”‚   sih-ml        â”‚  â”‚   sih-redis     â”‚
â”‚   (PostgreSQL)  â”‚  â”‚   (FastAPI)     â”‚  â”‚   (Cache)       â”‚
â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
â”‚   Port: 5432    â”‚  â”‚   Port: 8000    â”‚  â”‚   Port: 6379    â”‚
â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
â”‚   - Auth DB     â”‚  â”‚   - XGBoost     â”‚  â”‚   - Sessions    â”‚
â”‚   - Business DB â”‚  â”‚   - Forecast    â”‚  â”‚   - Rate Limit  â”‚
â”‚   - Credits     â”‚  â”‚   - ERA5 Data   â”‚  â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OBSERVABILITY STACK                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Grafana       â”‚  â”‚   Prometheus    â”‚  â”‚   Loki          â”‚
â”‚   (Dashboards)  â”‚  â”‚   (Metrics)     â”‚  â”‚   (Logs)        â”‚
â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
â”‚   Port: 3001    â”‚  â”‚   Port: 9090    â”‚  â”‚   Port: 3100    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Tempo         â”‚  â”‚   OTEL Collectorâ”‚  â”‚   Promtail      â”‚
â”‚   (Traces)      â”‚  â”‚   (Telemetry)   â”‚  â”‚   (Log Agent)   â”‚
â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
â”‚   Port: 3200    â”‚  â”‚   Port: 4317    â”‚  â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Project Structure

```
PS2-SIH25/
â”œâ”€â”€ ML/                              # Machine Learning Service
â”‚   â”œâ”€â”€ server.py                    # FastAPI ML server
â”‚   â”œâ”€â”€ Dockerfile                   # ML container config
â”‚   â”œâ”€â”€ requirements.txt             # Python dependencies
â”‚   â”œâ”€â”€ artifacts/                   # Trained models
â”‚   â”‚   â”œâ”€â”€ FINAL_PRODUCTION_MODELS/
â”‚   â”‚   â”‚   â”œâ”€â”€ production_O3_era5_spatial.json
â”‚   â”‚   â”‚   â””â”€â”€ production_NO2_era5_spatial.json
â”‚   â”‚   â””â”€â”€ VALIDATION_MODELS/
â”‚   â”œâ”€â”€ Data_SIH_2025_with_blh/     # Training data
â”‚   â”‚   â”œâ”€â”€ site_*_train_data.csv   # Per-site training data
â”‚   â”‚   â”œâ”€â”€ site_*_unseen_input_data.csv
â”‚   â”‚   â”œâ”€â”€ train_dataset_engineered.csv
â”‚   â”‚   â”œâ”€â”€ era5_station_timeseries_with_blh-forecast.csv
â”‚   â”‚   â””â”€â”€ lat_lon_sites.txt
â”‚   â”œâ”€â”€ utilities/                   # Data processing scripts
â”‚   â”‚   â”œâ”€â”€ train-dataset-engineered.py
â”‚   â”‚   â”œâ”€â”€ data-era5-downoload.py
â”‚   â”‚   â”œâ”€â”€ era5-data-extract.py
â”‚   â”‚   â””â”€â”€ data-with-blh.py
â”‚   â””â”€â”€ notebooks/                   # Jupyter notebooks
â”‚       â””â”€â”€ final-er5/
â”‚
â”œâ”€â”€ webdev/                          # Next.js Web Application
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/                     # Pages & Routes
â”‚   â”‚   â”‚   â”œâ”€â”€ api/                 # API routes
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ [[...slugs]]/   # Elysia API handler
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ aqi/            # AQI endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/          # Main dashboard
â”‚   â”‚   â”‚   â”œâ”€â”€ docs/               # API documentation
â”‚   â”‚   â”‚   â””â”€â”€ (auth)/             # Authentication pages
â”‚   â”‚   â”œâ”€â”€ services/               # Backend services
â”‚   â”‚   â”‚   â”œâ”€â”€ citizen/            # Citizen portal
â”‚   â”‚   â”‚   â”œâ”€â”€ business/           # Business API
â”‚   â”‚   â”‚   â”œâ”€â”€ gov/                # Government portal
â”‚   â”‚   â”‚   â””â”€â”€ public-api/         # Public API v1
â”‚   â”‚   â”œâ”€â”€ lib/                    # Shared utilities
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts             # Better Auth config
â”‚   â”‚   â”‚   â”œâ”€â”€ db/                 # Prisma clients
â”‚   â”‚   â”‚   â””â”€â”€ logger.ts           # Logging
â”‚   â”‚   â””â”€â”€ components/             # React components
â”‚   â”œâ”€â”€ prisma/                     # Database schemas
â”‚   â”‚   â””â”€â”€ schema.prisma
â”‚   â””â”€â”€ docs/
â”‚       â””â”€â”€ buisness_model.md
â”‚
â”œâ”€â”€ docker/                          # Docker configs
â”‚   â”œâ”€â”€ init-db.sql                 # Database initialization
â”‚   â””â”€â”€ observability/              # Monitoring configs
â”‚
â”œâ”€â”€ nginx/                          # Reverse proxy
â”‚   â””â”€â”€ nginx.conf
â”‚
â”œâ”€â”€ terraform/                       # Infrastructure as Code
â”‚   â””â”€â”€ main.tf
â”‚
â””â”€â”€ docker-compose.yml              # Service orchestration
```

---

## ğŸ”„ Complete Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPLETE REQUEST FLOW EXAMPLE                         â”‚
â”‚                    (User requests forecast)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  User    â”‚
    â”‚ Browser  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 1. Login & Navigate to Dashboard
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    NEXT.JS FRONTEND                           â”‚
    â”‚                    (localhost:3000)                           â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 2. Select Site & Click "Get Forecast"
         â”‚    POST /api/aqi/forecast/timeseries
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    ELYSIA API LAYER                           â”‚
    â”‚                                                               â”‚
    â”‚    1. Verify user session (Better Auth)                       â”‚
    â”‚    2. Load sample data for selected site                      â”‚
    â”‚    3. Forward to ML service                                   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 3. POST /plots/timeseries/json/
         â”‚    { site_id: "site_1", data: [...] }
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    ML SERVICE (FastAPI)                       â”‚
    â”‚                    (localhost:8000)                           â”‚
    â”‚                                                               â”‚
    â”‚    1. Parse input data                                        â”‚
    â”‚    2. Detect if future data (NaN targets)                     â”‚
    â”‚    3. Run recursive forecasting if needed                     â”‚
    â”‚    4. Apply XGBoost models                                    â”‚
    â”‚    5. Format response                                         â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 4. Return predictions
         â”‚    { dates: [...], forecast: { O3_target: [...], NO2_target: [...] } }
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    VISUALIZATION                              â”‚
    â”‚                                                               â”‚
    â”‚    â€¢ Time series charts                                       â”‚
    â”‚    â€¢ Performance metrics                                      â”‚
    â”‚    â€¢ Pollution alerts                                         â”‚
    â”‚    â€¢ Download options (CSV, JSON)                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Business Model Integration

The system supports three tiers:

| Tier | Users | Access | Cost |
|------|-------|--------|------|
| **Tier 1** | Citizens | Basic forecasts, alerts | Free |
| **Tier 2** | Government | Priority access, dashboards | Free (Priority) |
| **Tier 3** | Enterprise | Full API, historical data | Credit-based |

### Credit System
- Sites List: 10 credits
- Sample Data: 50 credits
- Forecast: 100 credits
- Timeseries: 150 credits

---

## ğŸš€ Quick Start

```bash
# 1. Clone the repository
git clone https://github.com/shreyanshjain05/PS2-SIH25.git
cd PS2-SIH25

# 2. Start all services
docker-compose up -d

# 3. Access the application
# Web App: http://localhost:3000
# ML API: http://localhost:8000
# Grafana: http://localhost:3001
```

---

## ğŸ“ API Quick Reference

### Generate Forecast (Public API)
```bash
curl -X POST http://localhost:3000/api/v1/forecast \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "site_id": "site_1",
    "data": [
      {
        "year": 2024, "month": 5, "day": 5, "hour": 0,
        "O3_forecast": 7.93, "NO2_forecast": 69.81,
        "T_forecast": 20.71, "q_forecast": 11.12,
        "u_forecast": -0.17, "v_forecast": -1.87,
        "w_forecast": -1.56, "blh_forecast": 32.83
      }
    ]
  }'
```

---

*Document generated: December 2025*
*Project: PS2-SIH25 - Smart India Hackathon 2025*
